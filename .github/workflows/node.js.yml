name: Build React Native Android App

on:
  # Define when the workflow should be triggered (e.g., on pushes to the main branch)
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest  # Replace with your preferred OS (adjust if needed)

    steps:
      - uses: actions/checkout@v4  # Checkout code from repository

      # Upgrade JRE (if needed)
      - name: Check JRE version
        run: |
          java -version
          if [[ $? -ne 0 ]]; then
            echo "WARNING: Java not found. Installing OpenJDK 17..."
          elif [[ $(java -version 2>&1 | grep -w version | awk '{print $3}') < "17" ]]; then
            echo "WARNING: Detected JRE version below 17. Upgrading to OpenJDK 17..."
          else
            echo "JRE version 17 or higher detected. Skipping upgrade."
            exit 0  # Exit step if JRE is already compatible
          fi

      - name: Install OpenJDK 17 (if needed)
        uses: actions/setup-java@v3
        with:
          distribution: 'adopt'  # Installs OpenJDK from Adoptium
          java-version: '17'  # Specify desired Java version (adjust if needed)
          # Consider adding `cache: 'maven'` to cache downloaded OpenJDK packages

      - name: Install dependencies
        run: npm install  # Or yarn install

      # Verify JRE upgrade (optional)
      - name: Verify JRE version after upgrade
        run: java -version  # Optional step to confirm successful JRE upgrade

      # Install Android SDK using the recommended action
      - uses: android-actions/setup-android@v3

      # Verify $ANDROID_HOME is properly set for later Gradle commands.
      - run: echo $ANDROID_HOME  # Print ANDROID_HOME for verification

      # (Optional) Additional verification for adb (if needed)
      - name: Verify adb functionality
        run: |
          which adb  # Check if adb is in the PATH
          if [[ $? -ne 0 ]]; then
            echo "WARNING: adb not found in PATH. Functionality might be limited."
          else
            adb devices  # Optional: Check for connected devices
          fi

      # Build the Android app
      - name: Run Android build
        run: npm run android # Adjust command based on your project

      # (Optional) Upload AAB artifact
      - uses: actions/upload-artifact@v3
        with:
          name: android-release.aab  # Adjust file name if needed
          path: android/app/build/outputs/bundle/release/app-release.aab  # Adjust path based on your project
